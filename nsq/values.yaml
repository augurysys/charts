# Default values for nsqd.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

nsqlookupdReplicaCount: 2
nsqdReplicaCount: 2
nsqadminReplicaCount: 1

image:
  repository: nsqio/nsq
  tag: v1.1.0
  pullPolicy: IfNotPresent

service:
  type: ClusterIP

dataVolumeClaim:
  storageClassName: faster
  storage: 512Mi

resources:
  limits:
   cpu: 500m
   memory: 512Mi
  requests:
   cpu: 100m
   memory: 128Mi

serviceMonitor:
  enabled: false
  alerting:
    rules:
    - name: nsqd.rules
      rules:
      - alert: NsqdChannelOverflow
        annotations:
          message: Channel {{`{{ $labels.channel }}`}} not clearing up with {{`{{ $value }}`}} messages in queue for 5 min.
        expr: 'sum(nsq_channel_depth{topic=~"events|tasks|alerts", paused="false",job="nsqd"}) by (channel) > 0'
        for: 5m
        labels:
          severity: critical
      - alert: NsqdTopicOverflow
        annotations:
          message: Topic {{`{{ $labels.topic }}`}} not clearing up with {{`{{ $value }}`}} messages in queue for 5 min.
        expr: 'sum(nsq_channel_depth{topic=~"algo.*", paused="false",job="nsqd"}) by (topic,channel) > 5'
        for: 5m
        labels:
          severity: warning
